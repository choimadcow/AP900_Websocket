<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Screen 2</title>
    <style>
        body { font-family: sans-serif; }
        .tabs {
            overflow: hidden;
            border: 1px solid #ccc;
            background-color: #f1f1f1;
        }
        .tabs a {
            background-color: inherit;
            float: left;
            border: none;
            outline: none;
            cursor: pointer;
            padding: 14px 16px;
            transition: 0.3s;
            text-decoration: none;
            color: black;
        }
        .tabs a:hover {
            background-color: #ddd;
        }
        .tabs a.active {
            background-color: #ccc;
        }
        .container { padding: 20px; }
        .grid-container {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-top: 20px;
        }
        .toggle-wrapper {
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #f0f0f0;
            border: 1px solid #ccc;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.1);
            cursor: pointer;
        }
        .toggle-text {
            font-size: 1.1em;
            font-weight: bold;
            color: #333;
        }
    </style>
</head>
<body>

<div class="tabs">
    <a href="/monitoring" class="tablinks">Screen 1</a>
    <a href="/monitoring/screen2" class="tablinks active">Screen 2</a>
</div>

<div class="container">
    <div class="grid-container">
        <div class="toggle-wrapper" onclick="setSpeed(0, 30)">
            <div class="toggle-text">0-30 km/h</div>
        </div>
        <div class="toggle-wrapper" onclick="setSpeed(31, 60)">
            <div class="toggle-text">31-60 km/h</div>
        </div>
        <div class="toggle-wrapper" onclick="setSpeed(61, 100)">
            <div class="toggle-text">61-100 km/h</div>
        </div>
        <div class="toggle-wrapper" onclick="setSpeed(101, 150)">
            <div class="toggle-text">100+ km/h</div>
        </div>
    </div>
    <hr style="margin: 1rem"/>
    <h3>Lane Change</h3>
    <div class="grid-container" style="grid-template-columns: repeat(2, 1fr);">
        <div>
            <h4>Direction</h4>
            <input type="radio" id="dir_none" name="direction" value="0" checked>
            <label for="dir_none">None</label><br>
            <input type="radio" id="dir_left" name="direction" value="1">
            <label for="dir_left">Left</label><br>
            <input type="radio" id="dir_right" name="direction" value="2">
            <label for="dir_right">Right</label>
        </div>
        <div>
            <h4>Process</h4>
            <input type="radio" id="proc_ready" name="process" value="0" checked>
            <label for="proc_ready">READY</label><br>
            <input type="radio" id="proc_blocked" name="process" value="1">
            <label for="proc_blocked">BLOCKED</label><br>
            <input type="radio" id="proc_changing" name="process" value="2">
            <label for="proc_changing">CHANGING</label>
        </div>
    </div>
    <div class="toggle-wrapper" onclick="setLaneChange()" style="margin-top: 20px; justify-content: center;">
        <div class="toggle-text">Send Lane Change</div>
    </div>
</div>

<script>
    async function setSpeed(min, max) {
        const speed = Math.floor(Math.random() * (max - min + 1)) + min;
        try {
            const response = await fetch(`/set-speed/${speed}`);
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            console.log(`Set speed to ${speed}`);
        } catch (error) {
            console.error(`Error setting speed:`, error);
            alert(`Failed to set speed. ${error.message}`);
        }
    }

    async function setLaneChange() {
        const direction = document.querySelector('input[name="direction"]:checked').value;
        const process = document.querySelector('input[name="process"]:checked').value;
        try {
            const response = await fetch('/set-lane-change', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ direction: parseInt(direction), process: parseInt(process) })
            });
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            console.log(`Set lane change to direction: ${direction}, process: ${process}`);
        } catch (error) {
            console.error(`Error setting lane change:`, error);
            alert(`Failed to set lane change. ${error.message}`);
        }
    }
</script>

</body>
</html>